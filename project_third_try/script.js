// üìö –ö–∞—Ç–∞–ª–æ–≥ –∫–Ω–∏–≥
const books = [
  {
    id: "master-i-margarita",
    title: "–ú–∞—Å—Ç–µ—Ä –∏ –ú–∞—Ä–≥–∞—Ä–∏—Ç–∞",
    author: "–ú–∏—Ö–∞–∏–ª –ë—É–ª–≥–∞–∫–æ–≤",
    year: 1967,
    genres: ["–†–æ–º–∞–Ω", "–§–∞–Ω—Ç–∞—Å—Ç–∏–∫–∞"],
    rating: 4.8,
    cover: "images/images.jpg",
    description: [
      "–ñ–∞—Ä–∫–∏–º –º–∞–π—Å–∫–∏–º –≤–µ—á–µ—Ä–æ–º –ø—Ä–µ–¥—Å–µ–¥–∞—Ç–µ–ª—å –ø—Ä–∞–≤–ª–µ–Ω–∏—è –ú–ê–°–°–û–õ–ò–¢ –ú–∏—Ö–∞–∏–ª –ë–µ—Ä–ª–∏–æ–∑...",
      "–ê–ª–µ–∫—Å–∞–Ω–¥—Ä –ë–µ—Ä–ª–∏–æ–∑ –∏ –ò–≤–∞–Ω –ë–µ–∑–¥–æ–º–Ω—ã–π —Å–æ—á–ª–∏ —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–∞ —Å—É–º–∞—Å—à–µ–¥—à–∏–º...",
      "–¢–µ–º –≤—Ä–µ–º–µ–Ω–µ–º –í–æ–ª–∞–Ω–¥ —Å–æ —Å–≤–∏—Ç–æ–π –≤–µ—Å—å–º–∞ –Ω–µ–æ–±—ã—á–Ω—ã–º –æ–±—Ä–∞–∑–æ–º –∏—Å—Å–ª–µ–¥—É—é—Ç..."
    ],
    excerpt: [
      "¬´–†—É–∫–æ–ø–∏—Å–∏ –Ω–µ –≥–æ—Ä—è—Ç¬ª ‚Äî –í–æ–ª–∞–Ω–¥.",
      "¬´–ß—Ç–æ –∂–µ —Ç—ã, –ò–≤–∞–Ω, –Ω–µ –≤–µ—Ä–∏—à—å –≤ –¥—å—è–≤–æ–ª–∞?¬ª",
      "¬´–ö–∞–∂–¥–æ–º—É –≤–æ–∑–¥–∞—Å—Ç—Å—è –ø–æ –≤–µ—Ä–µ –µ–≥–æ¬ª."
    ],
    review: "–ë—É–ª–≥–∞–∫–æ–≤ —Å–æ–∑–¥–∞–ª –Ω–µ –ø—Ä–æ—Å—Ç–æ —Ä–æ–º–∞–Ω, –∞ —Ñ–∏–ª–æ—Å–æ—Ñ—Å–∫—É—é –ø—Ä–∏—Ç—á—É –æ –¥–æ–±—Ä–µ –∏ –∑–ª–µ.",
    link: "book.html?id=master-i-margarita"
  },
  {
    id: "prestuplenie-i-nakazanie",
    title: "–ü—Ä–µ—Å—Ç—É–ø–ª–µ–Ω–∏–µ –∏ –Ω–∞–∫–∞–∑–∞–Ω–∏–µ",
    author: "–§—ë–¥–æ—Ä –î–æ—Å—Ç–æ–µ–≤—Å–∫–∏–π",
    year: 1866,
    genres: ["–†–æ–º–∞–Ω", "–ü—Å–∏—Ö–æ–ª–æ–≥–∏—è"],
    rating: 4.6,
    cover: "https://upload.wikimedia.org/wikipedia/commons/4/4b/Crimeandpunishmentcover.png",
    description: [
      "–ò—Å—Ç–æ—Ä–∏—è —Å—Ç—É–¥–µ–Ω—Ç–∞ –†–∞—Å–∫–æ–ª—å–Ω–∏–∫–æ–≤–∞, —Å–æ–≤–µ—Ä—à–∏–≤—à–µ–≥–æ —É–±–∏–π—Å—Ç–≤–æ –∏ –ø–µ—Ä–µ–∂–∏–≤–∞—é—â–µ–≥–æ –Ω—Ä–∞–≤—Å—Ç–≤–µ–Ω–Ω—ã–µ –º—É–∫–∏."
    ],
    excerpt: [
      "¬´–¢–≤–∞—Ä—å –ª–∏ —è –¥—Ä–æ–∂–∞—â–∞—è –∏–ª–∏ –ø—Ä–∞–≤–æ –∏–º–µ—é?¬ª",
      "¬´–°—Ç—Ä–∞–¥–∞–Ω–∏–µ ‚Äî –≤–µ–ª–∏–∫–∞—è –≤–µ—â—å¬ª"
    ],
    review: "–ì–ª—É–±–æ–∫–æ–µ –ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–µ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ —á–µ–ª–æ–≤–µ—á–µ—Å–∫–æ–π —Å–æ–≤–µ—Å—Ç–∏ –∏ –º–æ—Ä–∞–ª–∏.",
    link: "book.html?id=prestuplenie-i-nakazanie"
  },
  {
    id: "anna-karenina",
    title: "–ê–Ω–Ω–∞ –ö–∞—Ä–µ–Ω–∏–Ω–∞",
    author: "–õ–µ–≤ –¢–æ–ª—Å—Ç–æ–π",
    year: 1877,
    genres: ["–†–æ–º–∞–Ω", "–ö–ª–∞—Å—Å–∏–∫–∞"],
    rating: 4.7,
    cover: "https://upload.wikimedia.org/wikipedia/commons/4/4e/Anna_Karenina_book_cover.jpg",
    description: [
      "–¢—Ä–∞–≥–∏—á–µ—Å–∫–∞—è –∏—Å—Ç–æ—Ä–∏—è –ª—é–±–≤–∏ –ê–Ω–Ω—ã –ö–∞—Ä–µ–Ω–∏–Ω–æ–π –∏ –í—Ä–æ–Ω—Å–∫–æ–≥–æ –Ω–∞ —Ñ–æ–Ω–µ —Ä–æ—Å—Å–∏–π—Å–∫–æ–π –∞—Ä–∏—Å—Ç–æ–∫—Ä–∞—Ç–∏–∏."
    ],
    excerpt: [
      "¬´–í—Å–µ —Å—á–∞—Å—Ç–ª–∏–≤—ã–µ —Å–µ–º—å–∏ –ø–æ—Ö–æ–∂–∏ –¥—Ä—É–≥ –Ω–∞ –¥—Ä—É–≥–∞...¬ª",
      "¬´–ï—Å–ª–∏ –∏—â–µ—à—å —Å–æ–≤–µ—Ä—à–µ–Ω—Å—Ç–≤–∞ ‚Äî —Ç—ã –µ–≥–æ –Ω–µ –Ω–∞–π–¥—ë—à—å¬ª"
    ],
    review: "–û–¥–∏–Ω –∏–∑ –≤–µ–ª–∏—á–∞–π—à–∏—Ö —Ä–æ–º–∞–Ω–æ–≤ –æ –ª—é–±–≤–∏, —Å–µ–º—å–µ –∏ –æ–±—â–µ—Å—Ç–≤–µ.",
    link: "book.html?id=anna-karenina"
  }
];

// üîç –ü–æ–ª—É—á–µ–Ω–∏–µ ID –∏–∑ URL
function getBookIdFromURL() {
  const params = new URLSearchParams(window.location.search);
  return params.get("id");
}

// üîé –ü–æ–∏—Å–∫ –∫–Ω–∏–≥–∏ –ø–æ ID
function findBookById(id) {
  return books.find(book => book.id === id);
}

// üìò –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∫–Ω–∏–≥–∏
function renderBookPage(book) {
  const container = document.getElementById("book-page");

  container.innerHTML = `
    <div class="left_container">
      <img src="${book.cover}" alt="${book.title}" class="book_cover" />
      <div class="excerpt">
        <h2>–¶–∏—Ç–∞—Ç—ã –∏–∑ –∫–Ω–∏–≥–∏</h2>
        ${book.excerpt.map(line => `<p>${line}</p>`).join("")}
      </div>
    </div>

    <div class="right-container">
      <div class="upper-container">
        <h1>${book.title}</h1>
        <div class="meta">–ê–≤—Ç–æ—Ä: ${book.author} ‚Ä¢ –ì–æ–¥: ${book.year} ‚Ä¢ –û—Ü–µ–Ω–∫–∞: ${book.rating} ‚≠ê</div>
        <div class="quote">"${book.review}"</div>
        <div class="buttons">
          <button>–ß–∏—Ç–∞—Ç—å —Å–µ–π—á–∞—Å</button>
          <button>–î–æ–±–∞–≤–∏—Ç—å –≤ –±–∏–±–ª–∏–æ—Ç–µ–∫—É</button>
        </div>
      </div>
      <div class="book-description">
        ${Array.isArray(book.description)
      ? book.description.map(p => `<p>${p}</p>`).join("")
      : `<p>${book.description}</p>`}
      </div>
    </div>
  `;
}

// üìö –ö–∞—Ç–∞–ª–æ–≥ –∫–Ω–∏–≥
function renderCatalogCards(books) {
  const bookList = document.getElementById("bookList");
  bookList.classList.add("book-list");

  books.forEach(book => {
    const card = document.createElement("a");
    card.className = "book-card";
    card.href = book.link;

    card.innerHTML = `
      <img src="${book.cover}" alt="${book.title}" class="book-cover">
      <div class="book-info">
        <div class="book-title">${book.title}</div>
        <div class="book-meta">–ê–≤—Ç–æ—Ä: ${book.author}</div>
        <div class="book-meta">–ì–æ–¥: ${book.year}</div>
        <div class="book-meta">–ñ–∞–Ω—Ä—ã: ${book.genres.join(", ")}</div>
        <div class="book-meta">–û—Ü–µ–Ω–∫–∞: ${book.rating} ‚≠ê</div>
        <div class="book-description">
          ${Array.isArray(book.description)
        ? book.description.map(p => `<p>${p}</p>`).join("")
        : `<p>${book.description}</p>`}
        </div>
      </div>
    `;

    card.addEventListener("click", () => {
      localStorage.setItem("selectedBook", JSON.stringify(book));
    });

    bookList.appendChild(card);
  });
}

// üè† –ù–æ–≤–∏–Ω–∫–∏ –Ω–∞ –≥–ª–∞–≤–Ω–æ–π
function renderMainCards(featuredBooks) {
  const container = document.getElementById("mainFeatured");

  featuredBooks.forEach(book => {
    const card = document.createElement("div");
    card.className = "new_release_card";
    card.style.backgroundColor = book.bgColor;

    card.innerHTML = `
      <img src="${book.cover}" alt="${book.title}" class="new_release_cover">
      <div class="new_release_info">
        <div class="new_release_title">${book.title}</div>
        <div class="new_release_rating">–û—Ü–µ–Ω–∫–∞: ${book.rating} ‚≠ê</div>
      </div>
    `;

    container.appendChild(card);
  });
}

// üöÄ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
document.addEventListener("DOMContentLoaded", () => {
  if (document.getElementById("bookList")) {
    renderCatalogCards(books);
  }

  if (document.getElementById("mainFeatured")) {
    const featuredBooks = books.map(book => ({
      title: book.title,
      rating: book.rating,
      cover: book.cover,
      bgColor: "#2a2a2a"
    }));
    renderMainCards(featuredBooks);
  }

  if (document.getElementById("book-page")) {
    const bookId = getBookIdFromURL();
    const book = findBookById(bookId) || JSON.parse(localStorage.getItem("selectedBook"));

    if (book) {
      renderBookPage(book);
    } else {
      document.getElementById("book-page").innerHTML = "<p>–ö–Ω–∏–≥–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞</p>";
    }
  }
});
